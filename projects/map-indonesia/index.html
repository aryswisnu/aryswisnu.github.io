<html>
  <head>
    <style>
      html,
      body {
      width: 100%;
      height: 100%;
      margin: 0;
      padding: 0;
      }
      #map_canvas {
      width: 100%;
      height: 100%
      }
      .infowindow * {
      font-size: 90%;
      margin: 0
      }
    </style>

    <script src="https://cdn.rawgit.com/aryswisnu/aryswisnu.github.io/master/projects/map-indonesia/geoxml3_kmlStr.js"></script>
    <script src="https://www.google.com/jsapi"></script>
    <script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyC9h9icjUbLnV4txic-Zjli2n9zFFrrZbQ"></script>
  </head>
  <body>
    <table style="width:100%; height:100%;">
      <tr style="width:100%; height:100%;">
        <td style="width:100%; height:100%;">
          <div id="map_canvas"></div>
        </td>
        <!-- <td>
          <div id="sidebar" style="width:300px;height:90vh; overflow:scroll"></div>
        </td> -->
      </tr>
    </table>
    <script>
      // globals
      var map = null;
      var infoWindow = null;
      var geoXml = null;
      var geoXmlDoc = null;
      var myLatLng = null;
      var myOptions = null;
      var mapCenter = null;
      var geocodeTheCountry = true;
      var gpolygons = [];

      // Fusion Table data ID
      var FT_ProvinsiTableID = "19lLpgsKdJRHL2O4fNmJ406ri9JtpIIk8a-AchA";
      var FT_KabupatenTableID = "1QDDRfgqcsi8_fYREIxt8VhHlWNaVIWGKz5644ONP";
      var FT_KecamatanTableID = "1Zvh6bejgz1eI2pwp-S-dyYcoAhmqefHe2yuVMGoc";
      var CountryName = "Indonesia";
      google.load('visualization', '1', {'packages': ['corechart', 'table', 'geomap']});

      // function createSidebar() {
      //   // set the query using the parameters
      //   var FT_Query2 = "SELECT 'nm_provinsi', 'nm_kabkota', 'nm_keca', 'geometry' FROM " + FT_TableID;
      //   var queryText = encodeURIComponent(FT_Query2);
      //   var query = new google.visualization.Query('http://www.google.com/fusiontables/gvizdata?tq=' + queryText);
      //
      //   //set the callback function
      //   query.send(getData);
      // }

      // Set a callback to run when the Google Visualization API is loaded.
      // google.setOnLoadCallback(createSidebar);

      var FTresponse = null;

      // myLatLng = new google.maps.LatLng(37.422104808, -122.0838851);
      // these set the initial center, zoom and maptype for the map
      // if it is not specified in the query string
      var lat = 0.7893;
      var lng = 113.9213;
      var zoomMinProvinsi = 5;
      var zoomMinKabupaten = 7;
      var zoomMinKecamatan = 10;
      var CountryName = "Indonesia";
      var maptype = google.maps.MapTypeId.ROADMAP;
      if (!isNaN(lat) && !isNaN(lng)) {
        myLatLng = new google.maps.LatLng(lat, lng);
      }
      // infoWindow = new google.maps.InfoWindow();
      //define callback function, this is called when the results are returned

      // function getData(response) {
      //   if (!response) {
      //     alert('no response');
      //     return;
      //   }
      //   if (response.isError()) {
      //     alert('Error in query: ' + response.getMessage() + ' ' + response.getDetailedMessage());
      //     return;
      //   }
      //   FTresponse = response;
      //   //for more information on the response object, see the documentation
      //   //http://code.google.com/apis/visualization/documentation/reference.html#QueryResponse
      //   numRows = response.getDataTable().getNumberOfRows();
      //   numCols = response.getDataTable().getNumberOfColumns();
      //
      //   fusiontabledata = "<table><tr>";
      //   fusiontabledata += "<th>" + response.getDataTable().getColumnLabel(1) + "</th>";
      //   //   }
      //   fusiontabledata += "</tr><tr>";
      //
      //   for (i = 0; i < numRows; i++) {
      //     fusiontabledata += "<td><a href='javascript:myFTclick(" + i + ")'>" + response.getDataTable().getValue(i, 1) + "</a></td>";
      //     fusiontabledata += "</tr><tr>";
      //   }
      //   fusiontabledata += "</table>";
      //   //display the results on the page
      //   // document.getElementById('sidebar').innerHTML = fusiontabledata;
      // }

      // function infoWindowContent(name, description) {
      //   content = '<div class="FT_infowindow"><h3>' + name + '</h3><div>' + description + '</div></div>';
      //   return content;
      // }

      // function myFTclick(row) {
      //   var description = FTresponse.getDataTable().getValue(row, 0);
      //   var name = FTresponse.getDataTable().getValue(row, 1);
      //   if (!gpolygons[row]) {
      //     var kml = FTresponse.getDataTable().getValue(row, 2);
      //     // create a geoXml3 parser for the click handlers
      //     var geoXml = new geoXML3.parser({
      //       map: map,
      //       zoom: false,
      //       infoWindow: infoWindow,
      //       singleInfoWindow: true
      //     });
      //
      //     geoXml.parseKmlString("<Placemark>" + kml + "</Placemark>");
      //     geoXml.docs[0].gpolygons[0].setMap(null);
      //     gpolygons[row] = geoXml.docs[0].gpolygons[0].bounds.getCenter();
      //   }
      //   var position = gpolygons[row];
      //   if (!infoWindow) infoWindow = new google.maps.InfoWindow({});
      //   infoWindow.setOptions({
      //     content: infoWindowContent(name, description),
      //     pixelOffset: new google.maps.Size(0, 2),
      //     position: position
      //   });
      //   infoWindow.open(map);
      // }

      function initialize() {
        myOptions = {
          zoom: zoomMinProvinsi,
          center: myLatLng,
          mapTypeId: maptype
        };

        map = new google.maps.Map(document.getElementById("map_canvas"), myOptions);
        // callLayer(FT_KabupatenTableID)
        // var geocoder = new google.maps.Geocoder();
        // if (geocoder && geocodeTheCountry) {
        //   geocoder.geocode({
        //     'address': CountryName + " Country"
        //   }, function(results, status) {
        //     if (status == google.maps.GeocoderStatus.OK) {
        //       if (status != google.maps.GeocoderStatus.ZERO_RESULTS) {
        //         map.setCenter(results[0].geometry.location);
        //         map.fitBounds(results[0].geometry.viewport);
        //       } else {
        //         alert("No results found");
        //       }
        //     } else {
        //       alert("Geocode was not successful for the following reason: " + status);
        //     }
        //   });
        // }

        // google.maps.event.addListener(layer, "click", function(event) {
        //   infoWindow.close();
        //   infoWindow.setContent(infoWindowContent(event.row.name_1.value, event.row.name_0.value));
        //   infoWindow.setPosition(event.latLng);
        //   infoWindow.open(map);
        // });

        // var FT_Query = "SELECT 'geometry' FROM " + tableID;
        // var FT_Options = {
        //   suppressInfoWindows: true,
        //   query: {
        //     from: tableID,
        //     select: 'geometry'
        //   },
        //   styles: [{
        //     polygonOptions: {
        //       fillColor: "#FFFFFF",
        //       fillOpacity: 0.35
        //     }
        //   }]
        // };
        // layer = new google.maps.FusionTablesLayer(FT_Options);
        // layer.setMap(map);
        var provinsiLayer = {
          query: {
            select: 'kml_4326',
            from: FT_ProvinsiTableID,
            where: "'name_0' = '" + CountryName + "';"
          },
          styles: [{
            polygonOptions: {
              fillColor: "#FF0000",
              fillOpacity: 0.1
            }
          }]
        }
        var kabupatenLayer = {
          query: {
            select: 'geometry',
            from: FT_KabupatenTableID
          },
          styles: [{
            polygonOptions: {
              fillColor: "#FFFF00",
              fillOpacity: 0.1
            }
          }]
        }
        var kecamatanLayer = {
          query: {
            select: 'geometry',
            from: FT_KecamatanTableID
          },
          styles: [{
            polygonOptions: {
              fillColor: "#FFFFFF",
              fillOpacity: 0.1
            }
          }]
        }
        var layer = new google.maps.FusionTablesLayer(provinsiLayer);
        layer.setMap(map);

        google.maps.event.addListener(map, 'zoom_changed', function() {
          var zoomLevel = map.getZoom();
          console.log(zoomLevel);
          if (zoomLevel >= zoomMinKabupaten && zoomLevel < zoomMinKecamatan) {
            console.log("KABUPATEN");
            layer.setOptions(kabupatenLayer);
          }else if (zoomLevel >= zoomMinKecamatan) {
            console.log("KECAMATAN");
            layer.setOptions(kecamatanLayer);
          }else{
            layer.setOptions(provinsiLayer);
          }
        })
      }
      google.maps.event.addDomListener(window, 'load', initialize);
    </script>
  </body>
</html>
