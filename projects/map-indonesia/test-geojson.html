<!DOCTYPE html>
<html>
  <head>
    <title>Data Layer: Simple</title>
    <meta name="viewport" content="initial-scale=1.0">
    <meta charset="utf-8">
    <style>
      /* Always set the map height explicitly to define the size of the div
       * element that contains the map. */
      #map {
        width: 100%;
        height: 100%;
        margin-top: -65px
      }
      /* Optional: Makes the sample page fill the window. */
      html, body {
        height: 100%;
        margin: 0;
        padding: 0;
      }
      #info-box {
        background-color: white;
        border: 1px solid black;
        bottom: 30px;
        height: 20px;
        padding: 10px;
        position: absolute;
        left: 30px;
      }
      #button_container{
        position: relative;
        top: 10px;
        left: 35%;
        z-index: 10;
        background-color: #fff;
        border: 2px solid #fff;
        border-radius: 3px;
        box-shadow: 0 2px 6px rgba(0,0,0,.3);
        cursor: pointer;
        margin-bottom: 22px;
        text-align: center;
      }
      #button_container:focus {outline:0;}
      #button_text_container{
       color: rgb(25,25,25);
       font-family: Roboto,Arial,sans-serif;
       font-size: 16px;
       line-height: 38px;
       padding-left: 5px;
       padding-right: 5px;
      }
    </style>
  </head>
  <body>
    <div>
      <button id="button_container" onClick="zoomControlClick()">
        <div id="button_text_container">
          Menampilkan <span id="current_map_text">Provinsi</span> | Klik untuk melihat: <span id="next_map_text">Kabupaten</span>
        </div>
      </button>
    </div>
    <div id="map"></div>
    <div id="info-box"></div>
    <script src="//ajax.googleapis.com/ajax/libs/jquery/1.11.0/jquery.min.js"></script>
    <script>
      var map;
      var latLng = {lat: 0.7893, lng: 113.9213};
      var zoomMinProvinsi = 5;
      var zoomMinKabupaten = 8;
      var zoomMinKecamatan = 10;

      let contentString = "";

      var provinsiLayer = 'https://cdn.rawgit.com/aryswisnu/aryswisnu.github.io/master/projects/map-indonesia/PROVINSI_ADMINISTRATIVE_AREA-SIMPLIFIED.geojson';
      var kabupatenLayer = 'https://cdn.rawgit.com/aryswisnu/aryswisnu.github.io/master/projects/map-indonesia/KABUKOTA_ADMINISTRATIVE_AREA-SIMPLIFIED.geojson';
      var kecamatanLayer = 'https://cdn.rawgit.com/aryswisnu/aryswisnu.github.io/master/projects/map-indonesia/KECAMATAN_ADMINISTRATIVE_AREA-SIMPLIFIED.geojson';

      function zoomControlText(currentMapText, nextMapText) {
        document.getElementById("current_map_text").innerHTML = currentMapText;
        document.getElementById("next_map_text").innerHTML = nextMapText;
      }

      function zoomControlClick(){
        var buttoncontainer = document.getElementById("button_container");
        var buttontext = document.getElementById("next_map_text").innerHTML;
        if(buttontext == 'Kabupaten'){
          map.setZoom(zoomMinKabupaten);
          // map.setCenter({lat: -6.21462, lng: 106.84513})
        }else if (buttontext == 'Kecamatan') {
          map.setZoom(zoomMinKecamatan);
          // map.setCenter({lat: -6.21462, lng: 106.84513})
        }else{
          map.setZoom(zoomMinProvinsi)
          map.setCenter(latLng)
        }
      }

      function initMap() {
        map = new google.maps.Map(document.getElementById('map'), {
          zoom: 4,
          center: {lat: 0.7893, lng: 113.9213},
          mapTypeId: google.maps.MapTypeId.ROADMAP
        });

        var provinsi = new google.maps.Data();
        var kabupaten = new google.maps.Data();
        var kecamatan = new google.maps.Data();

        var infoWindow = new google.maps.InfoWindow;

        provinsi.loadGeoJson(provinsiLayer);
        kabupaten.loadGeoJson(kabupatenLayer);
        kecamatan.loadGeoJson(kecamatanLayer);

        provinsi.setStyle(function(feature) {
          var color = '#008000';
          if (feature.getProperty('isColorful')) {
            color = feature.getProperty('color');
          }
          return({
            fillColor: color,
            fillOpacity: 0.1,
            strokeColor: color,
            strokeWeight: 0.8
          });
        });
        kabupaten.setStyle(function(feature) {
          var color = '#FFA500';
          if (feature.getProperty('isColorful')) {
            color = feature.getProperty('color');
          }
          return({
            fillColor: color,
            fillOpacity: 0.1,
            strokeColor: color,
            strokeWeight: 0.8
          });
        });
        kecamatan.setStyle(function(feature) {
          var color = '#FF0000';
          if (feature.getProperty('isColorful')) {
            color = feature.getProperty('color');
          }
          return({
            fillColor: color,
            fillOpacity: 0.1,
            strokeColor: color,
            strokeWeight: 0.8
          });
        });
        // provinsi.addListener('mouseover', function(event) {
        //   document.getElementById('info-box').textContent =
        //       event.feature.getProperty('nm_keca');
        // });

        var toTitleCase = ((str) => {
          return str.replace(/\w\S*/g, function(txt){return txt.charAt(0).toUpperCase() + txt.substr(1).toLowerCase();});
        })

        provinsi.addListener('click', function(event) {
          contentString = '<b>Provinsi: </b>'+event.feature.getProperty('nm_provinsi');
          infoWindow = new google.maps.InfoWindow({
            position: event.latLng,
            map: map,
            content: contentString
          });
        });
        kabupaten.addListener('click', function(event) {
          contentString = '<p><b>Provinsi: </b>'+event.feature.getProperty('nm_provinsi')+'</p>'+
          '<p><b>Kabupaten: </b>'+toTitleCase(event.feature.getProperty('nm_kabkota'))+'</p>';
          infoWindow = new google.maps.InfoWindow({
            position: event.latLng,
            map: map,
            content: contentString
          });
        });
        kecamatan.addListener('click', function(event) {
          contentString = '<p><b>Provinsi: </b>'+event.feature.getProperty('nm_provinsi')+'</p>'+
          '<p><b>Kabupaten: </b>'+toTitleCase(event.feature.getProperty('nm_kabkota'))+'</p>'+
          '<p><b>Kecamatan: </b>'+toTitleCase(event.feature.getProperty('nm_keca'))+'</p>';
          infoWindow = new google.maps.InfoWindow({
            position: event.latLng,
            map: map,
            content: contentString
          });
        });

        provinsi.addListener('mouseover', function(event) {
          provinsi.revertStyle();
          provinsi.overrideStyle(event.feature, {fillOpacity: 1, strokeWeight: 1});
          document.getElementById('info-box').textContent = event.feature.getProperty('nm_provinsi');
        });
        provinsi.addListener('mouseout', function(event) {
          provinsi.revertStyle();
          infoWindow.close();
        });
        kabupaten.addListener('mouseover', function(event) {
          kabupaten.revertStyle();
          kabupaten.overrideStyle(event.feature, {fillOpacity: 1, strokeWeight: 1});
          document.getElementById('info-box').textContent = event.feature.getProperty('nm_kabkota');
        });
        kabupaten.addListener('mouseout', function(event) {
          kabupaten.revertStyle();
          infoWindow.close();
        });
        kecamatan.addListener('mouseover', function(event) {
          kecamatan.revertStyle();
          kecamatan.overrideStyle(event.feature, {fillOpacity: 1, strokeWeight: 1});
          document.getElementById('info-box').textContent = event.feature.getProperty('nm_keca');
        });
        kecamatan.addListener('mouseout', function(event) {
          kecamatan.revertStyle();
          infoWindow.close();
        });

        provinsi.setMap(map)

        google.maps.event.addListener(map, 'zoom_changed', function() {
          var zoomLevel = map.getZoom();
          console.log(zoomLevel);
          if (zoomLevel >= zoomMinKabupaten && zoomLevel < zoomMinKecamatan) {
            console.log("KABUPATEN");
            // provinsi.loadGeoJson('http://localhost/aryswisnu.github.io/projects/map-indonesia/KABUKOTA_ADMINISTRATIVE_AREA-SIMPLIFIED.geojson');
            zoomControlText('Kabupaten', 'Kecamatan')
            infoWindow.close();
            provinsi.setMap(null);
            kecamatan.setMap(null);
            kabupaten.setMap(map);
            infoWindow.close();
          }else if (zoomLevel >= zoomMinKecamatan) {
            console.log("KECAMATAN");
            // provinsi.loadGeoJson('http://localhost/aryswisnu.github.io/projects/map-indonesia/KECAMATAN_ADMINISTRATIVE_AREA-SIMPLIFIED.geojson');
            zoomControlText('Kecamatan', 'Provinsi')
            infoWindow.close();
            kabupaten.setMap(null);
            kecamatan.setMap(map);
            infoWindow.close();
          }else{
            console.log('PROVINSI');
            // provinsi.loadGeoJson('http://localhost/aryswisnu.github.io/projects/map-indonesia/PROVINSI_ADMINISTRATIVE_AREA-SIMPLIFIED.geojson');
            zoomControlText('Provinsi', 'Kabupaten')
            infoWindow.close();
            kabupaten.setMap(null);
            kecamatan.setMap(null);
            provinsi.setMap(map);
          }
        })

        // areaState.setStyle(function(feature) {
        //   var color = '#008000';
        //   if (feature.getProperty('isColorful')) {
        //     color = feature.getProperty('color');
        //   }
        //   return({
        //     fillColor: color,
        //     strokeColor: color,
        //     strokeWeight: 0.2
        //   });
        // });
        //
        // areaState.addListener('mouseover', function(event) {
        //   areaState.revertStyle();
        //   areaState.overrideStyle(event.feature, {strokeWeight: 1});
        //   document.getElementById('info-box').textContent = event.feature.getProperty('nm_provinsi');
        // });
        // areaState.addListener('mouseout', function(event) {
        //   areaState.revertStyle();
        // });
        //
        // var infoWindow = new google.maps.InfoWindow;
        // areaState.addListener('click', function(event) {
        //   infoWindow = new google.maps.InfoWindow({
        //     position: event.latLng,
        //     map: map,
        //     content: event.feature.getProperty('nm_provinsi')
        //   });
        // });
        //
        // areaState.setMap(map)
        // areaState.setMap(map)
      }
    </script>
    <script async defer
    src="https://maps.googleapis.com/maps/api/js?key=AIzaSyC9h9icjUbLnV4txic-Zjli2n9zFFrrZbQ&callback=initMap">
    </script>
  </body>
</html>
